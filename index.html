<!DOCTYPE html>
<html>
<body>
<h2>Stereo WebRTC Test</h2>
<button onclick="start()">Start</button>
<pre id="log"></pre>

<script>
let pc;

function log(t){ document.getElementById("log").textContent += t + "\n"; }

function enableStereo(sdp){
  return sdp.replace(
    /a=fmtp:111 minptime=10;useinbandfec=1/g,
    "a=fmtp:111 minptime=10;useinbandfec=1;stereo=1;sprop-stereo=1"
  );
}

async function start(){
  const stream = await navigator.mediaDevices.getUserMedia({
    audio:{
      channelCount:2,
      sampleRate:48000,
      echoCancellation:false,
      noiseSuppression:false,
      autoGainControl:false
    }
  });

  pc = new RTCPeerConnection();
  stream.getTracks().forEach(t=>pc.addTrack(t,stream));

  pc.ontrack = e=>{
    const audio = new Audio();
    audio.srcObject = e.streams[0];
    audio.play();
  };

  const offer = await pc.createOffer();
  await pc.setLocalDescription({type:"offer", sdp: enableStereo(offer.sdp)});
  log("Stereo offer created");
}
</script>
</body>
</html>
