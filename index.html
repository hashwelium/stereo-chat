<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Stereo Voice Chat</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #0f172a;
      color: white;
      margin-top: 100px;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      border-radius: 10px;
      border: none;
      background: #38bdf8;
      color: black;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>ðŸŽ§ Stereo Voice Chat</h1>
<button id="startBtn">é€šè©±é–‹å§‹</button>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io("https://YOUR-RENDER-URL");

let localStream;
let peerConnection;

const config = {
  iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
};

async function getStereoStream() {
  return await navigator.mediaDevices.getUserMedia({
    audio: {
      channelCount: 2,
      echoCancellation: false,
      noiseSuppression: false,
      autoGainControl: false
    }
  });
}

document.getElementById("startBtn").onclick = async () => {
  localStream = await getStereoStream();

  peerConnection = new RTCPeerConnection(config);

  localStream.getTracks().forEach(track => {
    peerConnection.addTrack(track, localStream);
  });

  peerConnection.ontrack = event => {
    const audio = document.createElement("audio");
    audio.srcObject = event.streams[0];
    audio.autoplay = true;
    document.body.appendChild(audio);
  };

  peerConnection.onicecandidate = event => {
    if (event.candidate) {
      socket.emit("ice-candidate", event.candidate);
    }
  };

  const offer = await peerConnection.createOffer();
  await peerConnection.setLocalDescription(offer);
  socket.emit("offer", offer);
};

socket.on("offer", async offer => {
  peerConnection = new RTCPeerConnection(config);

  localStream = await getStereoStream();
  localStream.getTracks().forEach(track => {
    peerConnection.addTrack(track, localStream);
  });

  peerConnection.ontrack = event => {
    const audio = document.createElement("audio");
    audio.srcObject = event.streams[0];
    audio.autoplay = true;
    document.body.appendChild(audio);
  };

  await peerConnection.setRemoteDescription(offer);
  const answer = await peerConnection.createAnswer();
  await peerConnection.setLocalDescription(answer);
  socket.emit("answer", answer);
});

socket.on("answer", async answer => {
  await peerConnection.setRemoteDescription(answer);
});

socket.on("ice-candidate", async candidate => {
  if (peerConnection) {
    await peerConnection.addIceCandidate(candidate);
  }
});
</script>

</body>
</html>
